<!DOCTYPE html>
<html>
<head>
  <title>Barcode IN/OUT Logger</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
  <h2>Scan Barcode</h2>
  <div id="scanner-container" style="width: 300px; height: 200px; border: 1px solid #ccc;"></div>
  <p id="scanned-code">Waiting for scan...</p>

  <button id="inBtn" disabled>IN</button>
  <button id="outBtn" disabled>OUT</button>

  <p id="log-status"></p>

  <script>
    let lastScannedCode = "";

    Quagga.init({
      inputStream: {
        type: "LiveStream",
        target: document.querySelector("#scanner-container"),
        constraints: { facingMode: "environment" }
      },
      decoder: { readers: ["ean_reader", "code_128_reader"] }
    }, function(err) {
      if (err) return console.error(err);
      Quagga.start();
    });

    Quagga.onDetected(function(data) {
      lastScannedCode = data.codeResult.code;
      document.getElementById("scanned-code").innerText = "Scanned: " + lastScannedCode;
      document.getElementById("inBtn").disabled = false;
      document.getElementById("outBtn").disabled = false;
    });

    async function logAction(action) {
      if (!lastScannedCode) return;

      const response = await fetch("https://script.google.com/macros/library/d/1zV3Tg0MbkLkN_A53xLuQaR1vLywgjTdK8kButkZWbzkHIBJBRNfpaycH/4", {
        method: "POST",
        contentType: "application/json",
        body: JSON.stringify({
          code: lastScannedCode,
          action: action
        })
      });

      const result = await response.json();
      document.getElementById("log-status").innerText = `${action} logged for ${lastScannedCode}`;
      document.getElementById("inBtn").disabled = true;
      document.getElementById("outBtn").disabled = true;
    }

    document.getElementById("inBtn").addEventListener("click", () => logAction("IN"));
    document.getElementById("outBtn").addEventListener("click", () => logAction("OUT"));
  </script>
</body>
</html>
