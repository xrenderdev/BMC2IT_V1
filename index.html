<!DOCTYPE html>
<html>
<head>
  <title>QR Code Scanner</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    #reader {
      width: 300px;
      margin: auto;
    }
    input, button {
      margin: 10px;
      padding: 10px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>QR Code Scanner</h1>
  <div id="reader"></div>
  <br>
  <input type="text" id="name" placeholder="Enter Name">
  <br>
  <input type="text" id="qr-result" placeholder="QR Code Result" readonly>
  <br>
  <button onclick="startScanner()">Scan QR Code</button>
  <button onclick="sendData()">Send</button>

  <script>
    let html5QrCode;

    function startScanner() {
      html5QrCode = new Html5Qrcode("reader");
      const config = { fps: 10, qrbox: 250 };
      const qrCodeSuccessCallback = (decodedText, decodedResult) => {
        document.getElementById("qr-result").value = decodedText;
        html5QrCode.stop();
      };

      Html5Qrcode.getCameras().then(devices => {
        const backCamera = devices.find(device => device.label.toLowerCase().includes('back')) || devices[0];
        html5QrCode.start(
          { deviceId: { exact: backCamera.id } },
          config,
          qrCodeSuccessCallback
        ).catch(err => console.error("Camera start failed", err));
      });
    }

    function sendData() {
      const name = document.getElementById("name").value;
      const qrCode = document.getElementById("qr-result").value;
      const timestamp = new Date().toISOString();
      const status = qrCode ? "Scanned" : "Failed";

      const url = "https://script.google.com/macros/s/AKfycby3G-2F1dSzPuXNgqKqo-7B6NjdxD9MXO_VTjxfArribBYClFCKhLC71HURxWHkKXQ7/exec";
      const params = new URLSearchParams({
        name,
        timestamp,
        qrcode: qrCode,
        status
      });

      fetch(`${url}?${params}`, { method: 'GET' })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.text();
        })
        .then(result => alert("Data sent successfully!"))
        .catch(error => {
          console.error("Fetch error:", error);
          alert("Error sending data: " + error.message);
        });
    }
  </script>
</body>
</html>
